<div class="container">
  <div class="make-company m-2 p-2">
    <h4>Company Make!</h4>
    <%= form_with model:@company, url: users_companies_path(@company), local: true do |f| %>
      <div class="row p-2">
        <div class="col-sm-3">
          <%= f.text_field :name, class: "form-control", placeholder: "Company name" %>
        </div>
        <div class="col-sm-2">
          <%= f.text_field :post_code, class: "form-control", placeholder: "〒" %>
        </div>
        <div class="col-sm-7">
          <%= f.text_field :address, class: "form-control", placeholder: "Address" %>
        </div>
      </div>
      <div class="row p-2">
        <div class="col-sm-3">
          <%= f.text_field :tel, class: "form-control", placeholder: "Telephone" %>
        </div>
        <div class="col-sm-3">
          <%= f.text_field :fax, class: "form-control", placeholder: "Fax Number" %>
        </div>
        <div class="col-sm-5">
          <%= f.text_field :ceo, class: "form-control", placeholder: "社長名" %>
        </div>
        <div class="col-sm-1">
          <%= f.check_box :supplier %>
          仕入
        </div>
      </div>
      <%= f.submit "登録", class: "btn btn-success m-2" %>
    <% end %>
  </div>
  <div class="company-list m-2 p-2">
    <h4>
      Company List!　
      <%= link_to "Supplier", users_companies_path(key: "supplier") %>　
      <%= link_to "User", users_companies_path(key: "user") %>　
      <%= link_to "All", users_companies_path %>
    </h4>
    <div class="row row-cols-2 row-cols-md-4 g-4">
      <% @companies.each do |company| %>
        <div class="col">
          <div class="card">
            <div class="card-body border">
              <h5 class="card-title">
                <%= company.name %>　<%= company.ceo %>社長
                <% if company.construction.count == 0 %>
                <% else %>
                  <span class="badge bg-success rounded-pill"><%= link_to company.construction.count, users_constructions_path(:id => company.id), class: "text-white" %></span>
                <% end %>
              </h5>
              <h6 class="card-subtitle mb-2 text-muted">Tel:<%= company.tel %>　fax:<%= company.fax %></h6>
              <% @persons.where(company_id: company.id).each do |person| %>
                <% if person.position == "" %>
                  <div class="card-text m-2">
                    <%= link_to person.name, users_jobs_path(:id => person.id) %>さん(<%= person.handy_phone %>)
                    <% if person.jobs.count == 0 %>
                    <% else %>
                      <span class="badge bg-danger rounded-pill"><%= person.jobs.count %></span>
                    <% end %>
                  </div>
                <% else %>
                  <div class="card-text m-2">
                    <%= link_to person.name, users_jobs_path(:id => person.id) %><%= person.position %>(<%= person.handy_phone %>)
                    <% if person.jobs.count == 0 %>
                    <% else %>
                      <span class="badge bg-danger rounded-pill"><%= person.jobs.count %></span>
                    <% end %>
                  </div>
                <% end %>
              <% end %>
              <a href="<%= edit_users_company_path(company) %>" class="card-link btn btn-warning btn-sm">訂正</a>
              <a href="<%= users_persons_path(:id => company.id) %>" class="card-link btn btn-primary btn-sm">担当</a>
              <a href="<%= users_company_path(company) %>" class="card-link btn btn-danger btn-sm" data-method = "delete" >削除</a>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
